<style>
    :root {
        --box-size: 100px;
    }

    html {
        height: 100%;
    }
    
    body {
        margin: 0;
    }

    .game {
        padding: 3rem 0;
        width: calc(var(--box-size) * 3);
        margin: 0 auto;
    }

    .game-info {
        display: flex;
        align-items: center;
        justify-content: space-between;
        text-align: center;
        margin-bottom: 1.6rem;
        position: relative;
        font-size: 1.8rem;
    }
    
    .game-info::after {
        content: '';
        position: absolute;
        left: 0;
        bottom: 0;
        height: 5px;
        width: 55px;
        background-color: #4c8bf5;
        transition: left cubic-bezier(0.4, 0, 0.2, 1) .5s;
    }

    .game-info[data-trn-player="1"]::after {
        left: calc(100% - 55px);
    }

    .game-info--player {
        padding: .5rem;
    }

    .game-info--score {
        border: 1px solid;
        padding: 4px 8px;
        border-radius: 8px;
    }

    .arena {
        display: grid;
        width: 100%;
        grid-template-columns: repeat(3, var(--box-size));
        grid-template-rows: repeat(3, var(--box-size));
        font-size: 3em;
    }
    .box {
        border: 1px solid;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: default;
    }

    .box__winner {
        background-color: #4c8bf5;
    }

    .box__next {
        opacity: .5;
    }
</style>

<div class="game">
    <div class="game-info" data-trn-player="0">
        <div class="game-info--player">⭕</div>
        <div class="game-info--score">
            <span class="game-info--score--player" data-score-player="0">0</span> - <span class="game-info--score--player" data-score-player="1">0</span>
        </div>
        <div class="game-info--player">❌</div>
    </div>

    <div class="arena">
        <div class="box" data-box-id="0"></div>
        <div class="box" data-box-id="1"></div>
        <div class="box" data-box-id="2"></div>
        <div class="box" data-box-id="3"></div>
        <div class="box" data-box-id="4"></div>
        <div class="box" data-box-id="5"></div>
        <div class="box" data-box-id="6"></div>
        <div class="box" data-box-id="7"></div>
        <div class="box" data-box-id="8"></div>
    </div>
</div>

<script>
const winnerBoxClassName = 'box__winner';
const nextBoxClassName = 'box__next';

const players = ['⭕', '❌'];
const boardWidth = 3;

class Regist {
    constructor() {
        this.turns = [];
        this.max = 3;
        this.points = 0;
    }

    add(index) {
        if (this.turns.length >= this.max) {
            boxes[this.turns[0]].innerText = '';
            this.turns.shift();
        }

        this.turns.push(index);
    }
}

const history = [new Regist(), new Regist()];

let currentTurn = 0;
let turnCount = 0;

function getCol(index) {
    return index % boardWidth;
}

function getRow(index) {
    return Math.floor(index / boardWidth);
}

function getIndex(col, row) {
    return col + boardWidth * row;
}

function nextTurn() {
    currentTurn ++;
    if (currentTurn > 1) currentTurn = 0;

    document.querySelector('.' + nextBoxClassName)?.classList.remove(nextBoxClassName);

    if (history[currentTurn].turns.length === 3) {
        const nextTurnBox = history[currentTurn].turns[0];
        boxes[nextTurnBox].classList.add(nextBoxClassName);
    }

    turnDisplay.dataset.trnPlayer = currentTurn;
}

function score(player) {
    history[player].turns.forEach(turn => {
        boxes[turn].classList.add(winnerBoxClassName);
    });

    history[player].points++;
    scoreDisplays[player].innerText = history[player].points;
}

function checkWin(index) {
    const row = getRow(index);
    const col = getCol(index);

    //check col
    for (let i = 0; i < boardWidth; i++) {
        if (boxes[getIndex(col, i)].innerText !== players[currentTurn]) break;

        if (i === boardWidth - 1) {
            return score(currentTurn);
        }
    }

    //check row

    for (let i = 0; i < boardWidth; i++) {
        if (boxes[getIndex(i, row)].innerText !== players[currentTurn]) break;

        if (i === boardWidth - 1) {
            return score(currentTurn);
        }
    }

    //check diags
    if (row === col) {
        for (let i = 0; i < boardWidth; i++) {
            if (boxes[getIndex(i, i)].innerText !== players[currentTurn]) break;

            if (i === boardWidth - 1) {
                return score(currentTurn);
            }
        }
    }

    if (row + col === boardWidth - 1) {
        for (let i = 0; i < boardWidth; i++) {
            if (boxes[getIndex(i, (boardWidth - 1) - i)].innerText !== players[currentTurn]) break;

            if (i === boardWidth - 1) {
                return score(currentTurn);
            }
        }
    }
}

const boxes = document.querySelectorAll('.box');
const scoreDisplays = document.querySelectorAll('[data-score-player]');
const turnDisplay = document.querySelector('[data-trn-player]');

function onClickBox() {
    if (this.innerText) return;

    document.querySelectorAll('.' + winnerBoxClassName).forEach(box => {
        box.classList.remove(winnerBoxClassName);
    });
    
    this.innerText = players[currentTurn];
    turnCount++;
    
    const index = Number(this.dataset.boxId);
    history[currentTurn].add(index);
    checkWin(index);
    nextTurn();
}

boxes.forEach(box => {
    box.addEventListener('click', onClickBox);
});
</script>